<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Typo Royale</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2rem; }
    #lobby, #game, #scores { margin-top: 2rem; display: none; }
    input, button { padding: 0.5rem; margin: 0.5rem; }
    #sentence { font-size: 1.2rem; margin: 1rem 0; }
  </style>
</head>
<body>
  <h1>Typo Royale</h1>

  <div id="setup">
    <button onclick="createRoom()">Create Room</button>
    <input id="roomInput" placeholder="Enter Room Code" />
    <button onclick="joinRoom()">Join Room</button>
  </div>

  <div id="lobby">
    <h2>Room: <span id="roomCode"></span></h2>
    <p>Players:</p>
    <ul id="playerList"></ul>
    <button onclick="startGame()">Start Game</button>
  </div>

  <div id="game">
    <div id="sentence"></div>
    <input id="typingInput" placeholder="Type here..." oninput="checkInput()" />
  </div>

  <div id="scores">
    <h2>Scores</h2>
    <ul id="scoreList"></ul>
  </div>

  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script>
    const socket = io('https://typo-royale-server.onrender.com'); // Replace with your actual Render URL
    let roomId = '';
    let sentence = '';
    let startTime = null;

    function createRoom() {
      roomId = generateRoomCode();
      document.getElementById('roomCode').textContent = roomId;
      socket.emit('createRoom', roomId);
      show('lobby');
    }

    function joinRoom() {
      roomId = document.getElementById('roomInput').value.toUpperCase();
      document.getElementById('roomCode').textContent = roomId;
      socket.emit('joinRoom', roomId);
      show('lobby');
    }

    function startGame() {
      sentence = "The quick brown fox jumps over the lazy dog.";
      socket.emit('startGame', roomId, sentence);
    }

    socket.on('roomUpdate', (players) => {
      const list = document.getElementById('playerList');
      list.innerHTML = '';
      players.forEach(p => {
        const li = document.createElement('li');
        li.textContent = p.id;
        list.appendChild(li);
      });
    });

    socket.on('gameStarted', (text) => {
      sentence = text;
      document.getElementById('sentence').textContent = sentence;
      document.getElementById('typingInput').value = '';
      startTime = Date.now();
      show('game');
    });

    function checkInput() {
      const input = document.getElementById('typingInput').value;
      if (input === sentence) {
        const timeTaken = (Date.now() - startTime) / 1000;
        const score = Math.round(1000 / timeTaken);
        socket.emit('submitScore', { roomId, score });
        show('scores');
      }
    }

    socket.on('scoreUpdate', (players) => {
      const list = document.getElementById('scoreList');
      list.innerHTML = '';
      players.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `${p.id}: ${p.score}`;
        list.appendChild(li);
      });
    });

    function generateRoomCode() {
      return Math.random().toString(36).substring(2, 7).toUpperCase();
    }

    function show(section) {
      ['setup', 'lobby', 'game', 'scores'].forEach(id => {
        document.getElementById(id).style.display = id === section ? 'block' : 'none';
      });
    }
  </script>
</body>
</html>
